---
import DashboardLayout from '../layouts/DashboardLayout.astro';
import '../styles/global.css';
import TransactionsManager from '../components/TransactionsManager.jsx';
import ContableApp from '../components/ContableApp';

// Check if month is specified in URL query params
const url = new URL(Astro.request.url);
const queryMonth = url.searchParams.get('month');

// Get current month in YYYY-MM format for filtering
const today = new Date();
const currentYearMonth = queryMonth || `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;

// Set up the data that will be passed to the React component
const userId = 1; // In a real app, get this from authentication
const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8000/graphql';

// Pass these variables to the client-side component
---

<DashboardLayout title="Transacciones">
  <ContableApp client:load />
  <div class="mb-6">
    <div class="flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-800">Administra tus Transacciones</h1>
      <button class="bg-primary-600 hover:bg-primary-700 text-white py-2 px-4 rounded-lg flex items-center">
        <i class="fas fa-plus mr-2"></i> Nueva Transacci√≥n
      </button>
    </div>
  </div>
  
  <!-- React component for transaction management -->
  <TransactionsManager 
    client:load
    userId={userId} 
    apiUrl={API_URL}
    initialMonth={currentYearMonth}
  />
</DashboardLayout>
